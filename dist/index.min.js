$(function(){function update(){var e={id:+new Date,name:$name.val(),code:$code.val(),type:$('input[name="videoType"]:checked').val()};isArray(baseTree[listID][e.type])||(baseTree[listID][e.type]=[]),baseTree[listID][e.type].push(e)}function render(e){$datas.empty(),flags={};for(var t in e){var a,n,i,l=e[t],o=+t,s="";if(flags[o]||(a=$('<div class="area area'+o+'">').appendTo($datas),n=$("<ul>").appendTo(a),i=$("<h3>"+$typeTitle.eq(o-1).data("name")+"</h3>").prependTo(a),flags[o]=!0),l.length){for(var d=0;d<l.length;d++)s+='<li data-id="'+l[d].id+'" data-type="'+o+'"><input type="button" class="del" value="删除" /><input type="button" class="edit" value="编辑" /><span title="'+l[d].name+'" class="name">'+l[d].name+"</span></li>";n.append(s)}}}function matchValue(){return""===$name.val()?(alert("请填写视频名称"),!1):""!==$code.val()||(alert("请填写视频代码"),!1)}function setValue(e){e?($name.val(e.name),$code.val(e.code),$type.eq(e.type-1).prop("checked",!0)):($name.val(""),$code.val(""),$type.eq(0).prop("checked",!0),$selector.val(0))}function isArray(e){return e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice&&!e.propertyIsEnumerable("length")}function showResult(){$("#result").html(format(JSON.stringify(baseTree),!1))}function format(txt,compress){var indentChar="    ";if(/^\s*$/.test(txt))return void alert("数据为空,无法格式化! ");try{var data=eval("("+txt+")")}catch(e){return void alert("数据源语法错误,格式化失败! 错误信息: "+e.description,"err")}var draw=[],last=!1,This=this,line=compress?"":"\n",nodeCount=0,maxDepth=0,notify=function(e,t,a,n,i){nodeCount++;for(var l=0,o="";l<n;l++)o+=indentChar;if(o=compress?"":o,maxDepth=++n,t&&t.constructor==Array){draw.push(o+(i?'"'+e+'":':"")+"["+line);for(var l=0;l<t.length;l++)notify(l,t[l],l==t.length-1,n,!1);draw.push(o+"]"+(a?line:","+line))}else if(t&&"object"==typeof t){draw.push(o+(i?'"'+e+'":':"")+"{"+line);var s=0,l=0;for(var d in t)s++;for(var d in t)notify(d,t[d],++l==s,n,!0);draw.push(o+"}"+(a?line:","+line))}else"string"==typeof t&&(t='"'+t+'"'),draw.push(o+(i?'"'+e+'":':"")+t+(a?"":",")+line)},isLast=!0,indent=0;return notify("",data,isLast,indent,!1),draw.join("")}var baseTree={1000:{1:[{id:"a11111",name:"111111",code:"1"},{id:"b222222",name:"222222222",code:"2"}],2:[{id:"c11111",name:"33333333",code:"1"}]}},$context=$("#d2"),$name=$context.find("#videoName"),$code=$context.find("#videoCode"),$type=$context.find('input[name="videoType"]'),$checked,$selector=$(".f-select"),$datas=$(".datas"),$typeTitle=$(".typeTittle"),iRadio=1,listID,max=$type.length,flags={},oIndexs={},d1=dialog({id:"d1",title:"添加视频 step1",width:400,height:400,okValue:"保存",ok:function(){return this.close(),showResult(),!1},cancel:function(){return this.close(),!1},cancelDisplay:!1,content:document.getElementById("d1")}),d2=dialog({id:"d2",title:"添加视频 step2",okValue:"保存",ok:function(){return matchValue()&&(update(),render(baseTree[listID]),this.close(),setValue(null)),!1},cancel:function(){return this.close(),setValue(null),!1},cancelDisplay:!1,content:document.getElementById("d2")});$(".btnAddVideo").on("click",function(){listID=$(this).data("listid"),$.isEmptyObject(baseTree[listID])&&(baseTree[listID]={}),render(baseTree[listID]),d1.showModal()}),$("#btnAddVideoList").on("click",function(){$(".f-li-select").hide(),d2.showModal()}),$(".datas").on("click",".edit",function(){$(".f-li-select").show();var e=$(this).parent("li"),t=e.index(),a=e.data("type");setValue(baseTree[listID][a][t]),d2.showModal()})});