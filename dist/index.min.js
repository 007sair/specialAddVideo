$(function(){function update(){$checked=$('input[name="videoType"]:checked'),baseTree[listID][id]={name:$name.val(),code:$code.val(),type:$checked.val(),index:0},iRadio=baseTree[listID][id].type}function renderLi(e,t){var n=oIndexs[e.type]++,a=$('<li data-id="'+t+'" data-type="'+e.type+'" data-index="'+n+'"><input type="button" class="del" value="删除" /><input type="button" class="edit" value="编辑" /><span title="'+e.name+'" class="name">'+e.name+"</span></li>"),i=$type.eq(e.type-1).parent().data("name");if(!flags[e.type]){var d=$(".datas"),o=$('<div class="area area'+e.type+'">').appendTo(d);$("<ul>").appendTo(o),$("<h3>"+i+"</h3>").prependTo(o);flags[e.type]=!0}e.index=n,$(".area"+e.type).find("ul").append(a)}function renderAll(e){for(var t=0;t<max;t++)oIndexs[t+1]=0;flags={},$(".datas").empty();for(var n in e)renderLi(e[n],n)}function match_d2_value(){return""===$name.val()?(alert("请填写视频名称"),!1):""!==$code.val()||(alert("请填写视频代码"),!1)}function set_d2_value(e){e?($name.val(e.name),$code.val(e.code),$type.eq(e.type-1).prop("checked",!0)):($name.val(""),$code.val(""),$type.eq(0).prop("checked",!0))}function sortData(){var e=$(".f-select").val(),t=baseTree[listID][id];if(console.log(t),1==e&&0==t.index)return!1}function showResult(){$("#result").html(format(JSON.stringify(baseTree),!1))}function format(txt,compress){var indentChar="    ";if(/^\s*$/.test(txt))return void alert("数据为空,无法格式化! ");try{var data=eval("("+txt+")")}catch(e){return void alert("数据源语法错误,格式化失败! 错误信息: "+e.description,"err")}var draw=[],last=!1,This=this,line=compress?"":"\n",nodeCount=0,maxDepth=0,notify=function(e,t,n,a,i){nodeCount++;for(var d=0,o="";d<a;d++)o+=indentChar;if(o=compress?"":o,maxDepth=++a,t&&t.constructor==Array){draw.push(o+(i?'"'+e+'":':"")+"["+line);for(var d=0;d<t.length;d++)notify(d,t[d],d==t.length-1,a,!1);draw.push(o+"]"+(n?line:","+line))}else if(t&&"object"==typeof t){draw.push(o+(i?'"'+e+'":':"")+"{"+line);var l=0,d=0;for(var s in t)l++;for(var s in t)notify(s,t[s],++d==l,a,!0);draw.push(o+"}"+(n?line:","+line))}else"string"==typeof t&&(t='"'+t+'"'),draw.push(o+(i?'"'+e+'":':"")+t+(n?"":",")+line)},isLast=!0,indent=0;return notify("",data,isLast,indent,!1),draw.join("")}var id,baseTree={1000:{1468028955456:{name:"分类1",code:"1",type:"1",index:21},1468028966102:{name:"分类2",code:"1",type:"1",index:22},1468028969572:{name:"标题1",code:"1",type:"2",index:14},1468028974779:{name:"标题2",code:"1",type:"2",index:15},1468028985708:{name:"底部1",code:"1",type:"3",index:14},1468028990846:{name:"底部2",code:"1",type:"3",index:15},1468073132243:{name:"分类3",code:"1",type:"1",index:23}},1001:{1468029214695:{name:"aaa",code:"1",type:"3"},1468029220959:{name:"bbb",code:"1",type:"2"}}},$context=$("#d2"),$name=$context.find("#videoName"),$code=$context.find("#videoCode"),$type=$context.find('input[name="videoType"]'),$checked,iRadio=1,listID,max=$type.length,flags={},oIndexs={},d1=dialog({id:"d1",title:"添加视频 step1",width:400,height:400,okValue:"保存",ok:function(){return this.close(),showResult(),!1},cancel:function(){return this.close(),!1},cancelDisplay:!1,content:document.getElementById("d1")}),d2=dialog({id:"d2",title:"添加视频 step2",okValue:"保存",ok:function(){return update(),match_d2_value()&&(renderAll(baseTree[listID]),this.close(),set_d2_value(null)),!1},cancel:function(){return this.close(),set_d2_value(null),!1},cancelDisplay:!1,content:document.getElementById("d2")});$(".btnAddVideo").on("click",function(){listID=$(this).data("listid"),$.isEmptyObject(baseTree[listID])&&(baseTree[listID]={}),renderAll(baseTree[listID]),d1.showModal(),console.log(baseTree[listID])}),$("#btnAddVideoList").on("click",function(){id=+new Date,d2.showModal()}),$(".datas").on("click",".edit",function(){var e=$(this).parent("li"),t=e.data("id");id=t,set_d2_value(baseTree[listID][id]),d2.showModal()}),$(".datas").on("click",".del",function(){var e=$(this).parent("li"),t=e.data("id"),n=$(this).siblings(".name").text();dialog({title:"警告",width:220,content:"确认要删除<b>"+n+"</b>吗？",ok:function(){e.remove(),delete baseTree[listID][t],renderAll(baseTree[listID])}}).showModal()}),$('input[name="videoType"]').on("change",function(){iRadio=$(this).val()})});