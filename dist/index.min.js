$(function(){function update(){$checked=$('input[name="videoType"]:checked'),baseTree[listID][id]={name:$name.val(),code:$code.val(),type:$checked.val()},iRadio=baseTree[listID][id].type}function renderLi(e,t){var a=$('<li data-id="'+t+'"><input type="button" class="del" value="删除" /><input type="button" class="edit" value="编辑" /><span title="'+e.name+'" class="name">'+e.name+"</span></li>"),n=$type.eq(e.type-1).parent().data("name");if(!flags[e.type]){var i=$(".datas"),d=$('<div class="area area'+e.type+'">').appendTo(i);$("<ul>").appendTo(d),$("<h3>"+n+"</h3>").prependTo(d);flags[e.type]=!0}$(".area"+e.type).find("ul").append(a)}function renderAll(e){flags={},$(".datas").empty();for(var t in e)renderLi(e[t],t)}function initData(){function e(){baseTree[listID][id]={name:$name.val(),code:$code.val(),type:$checked.val()},iRadio=baseTree[listID][id].type}if($checked=$('input[name="videoType"]:checked'),match_d2_value()){if(baseTree[listID][id]){e();var t=$('li[data-id="'+id+'"]');t.find(".name").text($name.val()),t.find("p").text($checked.parent().data("name"))}else{e();var a='<li data-id="'+id+'"><p>'+$checked.parent().data("name")+'</p><input type="button" class="del" value="删除" /><input type="button" class="edit" value="编辑" /><span title="'+$name.val()+'" class="name">'+$name.val()+"</span></li>";$(".datas").append(a)}return console.log(iRadio),!0}return!1}function match_d2_value(){return""===$name.val()?(alert("请填写视频名称"),!1):""!==$code.val()||(alert("请填写视频代码"),!1)}function set_d2_value(e){e?($name.val(e.name),$code.val(e.code),$type.eq(e.type-1).prop("checked",!0)):($name.val(""),$code.val(""),$type.eq(0).prop("checked",!0))}function showResult(){$("#result").html(format(JSON.stringify(baseTree),!1))}function format(txt,compress){var indentChar="    ";if(/^\s*$/.test(txt))return void alert("数据为空,无法格式化! ");try{var data=eval("("+txt+")")}catch(e){return void alert("数据源语法错误,格式化失败! 错误信息: "+e.description,"err")}var draw=[],last=!1,This=this,line=compress?"":"\n",nodeCount=0,maxDepth=0,notify=function(e,t,a,n,i){nodeCount++;for(var d=0,l="";d<n;d++)l+=indentChar;if(l=compress?"":l,maxDepth=++n,t&&t.constructor==Array){draw.push(l+(i?'"'+e+'":':"")+"["+line);for(var d=0;d<t.length;d++)notify(d,t[d],d==t.length-1,n,!1);draw.push(l+"]"+(a?line:","+line))}else if(t&&"object"==typeof t){draw.push(l+(i?'"'+e+'":':"")+"{"+line);var o=0,d=0;for(var s in t)o++;for(var s in t)notify(s,t[s],++d==o,n,!0);draw.push(l+"}"+(a?line:","+line))}else"string"==typeof t&&(t='"'+t+'"'),draw.push(l+(i?'"'+e+'":':"")+t+(a?"":",")+line)},isLast=!0,indent=0;return notify("",data,isLast,indent,!1),draw.join("")}var id,baseTree={1000:{1468028955456:{name:"111111",code:"1",type:"1"},1468028966102:{name:"222222222",code:"1",type:"1"},1468028969572:{name:"11111111",code:"1",type:"2"},1468028974779:{name:"222222222",code:"1",type:"2"},1468028985708:{name:"1111111111",code:"1",type:"3"},1468028990846:{name:"222222",code:"1",type:"3"}},1001:{1468029214695:{name:"aaa",code:"1",type:"3"},1468029220959:{name:"bbb",code:"1",type:"2"}}},$context=$("#d2"),$name=$context.find("#videoName"),$code=$context.find("#videoCode"),$type=$context.find('input[name="videoType"]'),$checked,iRadio=1,listID,flags={},d1=dialog({id:"d1",title:"添加视频 step1",width:400,height:400,okValue:"保存",ok:function(){return this.close(),showResult(),!1},cancel:function(){return this.close(),!1},cancelDisplay:!1,content:document.getElementById("d1")}),d2=dialog({id:"d2",title:"添加视频 step2",okValue:"保存",ok:function(){return update(),match_d2_value()&&(renderAll(baseTree[listID]),this.close(),set_d2_value(null)),!1},cancel:function(){return this.close(),!1},cancelDisplay:!1,content:document.getElementById("d2")});$(".btnAddVideo").on("click",function(){listID=$(this).data("listid"),$.isEmptyObject(baseTree[listID])&&(baseTree[listID]={}),renderAll(baseTree[listID]),d1.showModal(),console.log(baseTree[listID])}),$("#btnAddVideoList").on("click",function(){id=+new Date,d2.showModal()}),$(".datas").on("click",".edit",function(){var e=$(this).parent("li"),t=e.data("id");id=t,set_d2_value(baseTree[listID][id]),d2.showModal()}),$(".datas").on("click",".del",function(){var e=$(this).parent("li"),t=e.data("id"),a=$(this).siblings(".name").text();dialog({title:"警告",width:220,content:"确认要删除<b>"+a+"</b>吗？",ok:function(){e.remove(),delete baseTree[listID][t]}}).showModal()}),$('input[name="videoType"]').on("change",function(){iRadio=$(this).val()})});