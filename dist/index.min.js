$(function(){function update(){var e={name:$name.val(),code:$code.val(),type:$('input[name="videoType"]:checked').val()};if(isArray(baseTree[listID][e.type])||(baseTree[listID][e.type]=[]),_index<0)baseTree[listID][e.type].push(e),sort(baseTree[listID][e.type],baseTree[listID][e.type].length-1);else{var t="";+_type!==+_radio?(baseTree[listID][_type].splice(_index,1),baseTree[listID][_radio].push(e),t=baseTree[listID][_radio].length-1):(baseTree[listID][_radio][_index]=e,t=_index),sort(baseTree[listID][_radio],t)}}function sort(e,t){var n=$selector.val();1==n&&(0==t?console.log("已经是第一个了"):swipe(e,t,t-1)),2==n&&(t>=e.length-1?console.log("已经是最后一个了"):swipe(e,t,t+1))}function swipe(e,t,n){return e[t]=e.splice(n,1,e[t])[0],e}function render(e){$datas.empty(),flags={};for(var t in e){var n,a,i,o=e[t],s=+t,l="";if(flags[s]||(n=$('<div class="area area'+s+'">'),a=$("<ul>").appendTo(n),i=$("<h3>"+$typeTitle.eq(s-1).data("name")+"</h3>").prependTo(n),flags[s]=!0),o.length){for(var d=0;d<o.length;d++)l+='<li data-type="'+s+'"><input type="button" class="del" value="删除" /><input type="button" class="edit" value="编辑" /><span title="'+o[d].name+'" class="name">'+o[d].name+"</span></li>";a.append(l),n.appendTo($datas)}}}function matchValue(){return""===$name.val()?(alert("请填写视频名称"),!1):""!==$code.val()||(alert("请填写视频代码"),!1)}function setValue(e){e?($name.val(e.name),$code.val(e.code),$type.eq(_type-1).prop("checked",!0)):($name.val(""),$code.val(""),$type.eq(0).prop("checked",!0),$selector.val(0),_index=-1)}function isArray(e){return e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice&&!e.propertyIsEnumerable("length")}function showResult(){$("#result").html(format(JSON.stringify(baseTree),!1))}function format(txt,compress){var indentChar="    ";if(/^\s*$/.test(txt))return void alert("数据为空,无法格式化! ");try{var data=eval("("+txt+")")}catch(e){return void alert("数据源语法错误,格式化失败! 错误信息: "+e.description,"err")}var draw=[],last=!1,This=this,line=compress?"":"\n",nodeCount=0,maxDepth=0,notify=function(e,t,n,a,i){nodeCount++;for(var o=0,s="";o<a;o++)s+=indentChar;if(s=compress?"":s,maxDepth=++a,t&&t.constructor==Array){draw.push(s+(i?'"'+e+'":':"")+"["+line);for(var o=0;o<t.length;o++)notify(o,t[o],o==t.length-1,a,!1);draw.push(s+"]"+(n?line:","+line))}else if(t&&"object"==typeof t){draw.push(s+(i?'"'+e+'":':"")+"{"+line);var l=0,o=0;for(var d in t)l++;for(var d in t)notify(d,t[d],++o==l,a,!0);draw.push(s+"}"+(n?line:","+line))}else"string"==typeof t&&(t='"'+t+'"'),draw.push(s+(i?'"'+e+'":':"")+t+(n?"":",")+line)},isLast=!0,indent=0;return notify("",data,isLast,indent,!1),draw.join("")}var baseTree={1000:{1:[{name:"顶部1",code:"1",type:"1",id:"a11111"}],2:[{name:"标题1",code:"1",type:"2",id:"undefined"},{name:"标题2",code:"2",type:"2",id:"undefined"}],3:[{name:"底部1",code:"1",type:"3",id:"c11111"},{name:"底部2",code:"2",type:"3",id:"b222222"}]}},$context=$("#d2"),$name=$context.find("#videoName"),$code=$context.find("#videoCode"),$type=$context.find('input[name="videoType"]'),$checked,$selector=$(".f-select"),$datas=$(".datas"),$typeTitle=$(".typeTittle"),_id,_index=-1,_type,_radio=1,listID,max=$type.length,flags={},oIndexs={},d1=dialog({id:"d1",title:"添加视频 step1",width:400,height:400,okValue:"保存",ok:function(){return this.close(),showResult(),!1},cancel:function(){return this.close(),!1},cancelDisplay:!1,content:document.getElementById("d1")}),d2=dialog({id:"d2",title:"添加视频 step2",okValue:"保存",ok:function(){return matchValue()&&(update(),render(baseTree[listID]),this.close()),!1},cancel:function(){return this.close(),!1},onclose:function(){setValue(null)},cancelDisplay:!1,content:document.getElementById("d2")});$(".btnAddVideo").on("click",function(){listID=$(this).data("listid"),$.isEmptyObject(baseTree[listID])&&(baseTree[listID]={}),render(baseTree[listID]),d1.showModal()}),$("#btnAddVideoList").on("click",function(){d2.showModal()}),$(".datas").on("click",".edit",function(){var e=$(this).parent("li");_type=e.data("type"),_id=e.data("id"),_index=e.index(),_radio=_type,setValue(baseTree[listID][_type][_index]),d2.showModal()}),$(".datas").on("click",".del",function(){var e=$(this).parent("li"),t=e.data("type"),n=e.index(),a=$(this).siblings(".name").text();dialog({title:"警告",width:220,content:"确认要删除<b>"+a+"</b>吗？",ok:function(){baseTree[listID][t].splice(n,1),render(baseTree[listID])}}).showModal()}),$(".f-radio").on("change",function(){_radio=$(this).val()})});